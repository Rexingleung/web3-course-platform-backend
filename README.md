# Web3 Course Platform - Backend

è¿™æ˜¯ä¸€ä¸ªåŸºäºæ™ºèƒ½åˆçº¦çš„è¯¾ç¨‹å¹³å°åç«¯æœåŠ¡ï¼Œä½¿ç”¨ Node.js + Express + TypeScript + MySQL æ„å»ºã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”— ä¸æ™ºèƒ½åˆçº¦é›†æˆï¼ŒåŒæ­¥è¯¾ç¨‹æ•°æ®
- ğŸ“Š ç”¨æˆ·è´­ä¹°è¯¾ç¨‹è®°å½•
- ğŸ“ è¯¾ç¨‹ç®¡ç†å’ŒæŸ¥è¯¢
- ğŸ‘¨â€ğŸ« ä½œè€…è¯¾ç¨‹ç®¡ç†
- ğŸ—„ï¸ MySQL æ•°æ®åº“å­˜å‚¨
- ğŸš€ RESTful API æ¥å£
- ğŸ”„ æ™ºèƒ½åˆçº¦æ•…éšœè½¬ç§»ï¼ˆæ•°æ®åº“åå¤‡ï¼‰

## æŠ€æœ¯æ ˆ

- Node.js + Express
- TypeScript
- MySQL2
- Ethers.js (Web3)
- CORS

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 16+
- MySQL 5.7+
- æ™ºèƒ½åˆçº¦å·²éƒ¨ç½²ï¼ˆå¯é€‰ï¼Œæœ‰æ•°æ®åº“åå¤‡ï¼‰

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. ç¯å¢ƒé…ç½®

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶é…ç½®ï¼š

```env
PORT=3001
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=&*&Ddasd123.ii2
DB_NAME=web3
CONTRACT_ADDRESS=0xdDD30BD07C402eE78079c35A7DE2F9232ed54Aa4
RPC_URL=http://localhost:8545
```

### 3. æ•°æ®åº“åˆå§‹åŒ–å’Œç§å­æ•°æ®

**é€‰é¡¹ A: å®Œæ•´è®¾ç½®ï¼ˆæ¨èï¼‰**
```bash
npm run setup
```

**é€‰é¡¹ B: åˆ†æ­¥éª¤è®¾ç½®**
```bash
# åˆ›å»ºæ•°æ®åº“è¡¨
npm run migrate

# æ’å…¥æµ‹è¯•æ•°æ®
npm run seed
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æœåŠ¡å°†è¿è¡Œåœ¨ http://localhost:3001

### 5. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
npm start
```

## API æ¥å£

### è¯¾ç¨‹ç›¸å…³

- `GET /api/courses` - è·å–æ‰€æœ‰è¯¾ç¨‹
- `GET /api/courses/:id` - è·å–æŒ‡å®šè¯¾ç¨‹
- `GET /api/courses/count` - è·å–è¯¾ç¨‹æ€»æ•°
- `GET /api/courses/author/:author` - è·å–ä½œè€…çš„è¯¾ç¨‹
- `POST /api/courses/sync` - åŒæ­¥æ™ºèƒ½åˆçº¦æ•°æ®

### è´­ä¹°ç›¸å…³

- `GET /api/courses/purchased/:userAddress` - è·å–ç”¨æˆ·è´­ä¹°çš„è¯¾ç¨‹
- `GET /api/courses/purchased/:courseId/:userAddress` - æ£€æŸ¥è´­ä¹°çŠ¶æ€
- `POST /api/courses/purchase` - è®°å½•è´­ä¹°äº¤æ˜“

### å¥åº·æ£€æŸ¥

- `GET /health` - æœåŠ¡çŠ¶æ€æ£€æŸ¥

## æ™ºèƒ½åˆçº¦é›†æˆ

åç«¯æœåŠ¡é€šè¿‡ ethers.js ä¸æ™ºèƒ½åˆçº¦äº¤äº’ï¼š

- åˆçº¦åœ°å€ï¼š`0xdDD30BD07C402eE78079c35A7DE2F9232ed54Aa4`
- æ”¯æŒè¯»å–è¯¾ç¨‹ä¿¡æ¯
- æ”¯æŒæŸ¥è¯¢ç”¨æˆ·è´­ä¹°è®°å½•
- è‡ªåŠ¨åŒæ­¥åˆçº¦æ•°æ®åˆ°æ•°æ®åº“
- **æ™ºèƒ½æ•…éšœè½¬ç§»**ï¼šå¦‚æœåˆçº¦ä¸å¯ç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨æ•°æ®åº“åå¤‡

## æµ‹è¯•æ•°æ®

è¿è¡Œ `npm run seed` åï¼Œç³»ç»Ÿä¼šæ’å…¥ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

### ç¤ºä¾‹è¯¾ç¨‹
1. **Web3 å¼€å‘å…¥é—¨** - 0.1 ETH
2. **DeFi åè®®æ·±åº¦è§£æ** - 0.2 ETH  
3. **NFT å¸‚åœºå¼€å‘å®æˆ˜** - 0.15 ETH
4. **Solidity é«˜çº§ç¼–ç¨‹æŠ€å·§** - 0.25 ETH
5. **Layer 2 æ‰©å®¹æ–¹æ¡ˆè¯¦è§£** - 0.18 ETH

### ç¤ºä¾‹ç”¨æˆ·åœ°å€
- `0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266`
- `0x70997970C51812dc3A010C7d01b50e0d17dc79C8`
- `0x742d35Cc6634C0532925a3b8D65aEd2934C12D5e`

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ MySQL æœåŠ¡çŠ¶æ€
   sudo systemctl status mysql
   
   # å¯åŠ¨ MySQLï¼ˆå¦‚éœ€è¦ï¼‰
   sudo systemctl start mysql
   ```

2. **"Database not initialized" é”™è¯¯**
   ```bash
   # é‡æ–°è¿è¡Œè¿ç§»
   npm run migrate
   ```

3. **æ™ºèƒ½åˆçº¦è¿æ¥å¤±è´¥**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æ•°æ®åº“åå¤‡
   - æ£€æŸ¥ RPC_URL é…ç½®
   - éªŒè¯åˆçº¦åœ°å€

### æµ‹è¯• API ç«¯ç‚¹

```bash
# è·å–æ‰€æœ‰è¯¾ç¨‹
curl http://localhost:3001/api/courses

# è·å–ç‰¹å®šç”¨æˆ·çš„å·²è´­è¯¾ç¨‹
curl http://localhost:3001/api/courses/purchased/0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266

# å¥åº·æ£€æŸ¥
curl http://localhost:3001/health
```

## æ•°æ®åº“ç»“æ„

### courses è¡¨

- `id` - è‡ªå¢ä¸»é”®
- `course_id` - æ™ºèƒ½åˆçº¦ä¸­çš„è¯¾ç¨‹ID
- `title` - è¯¾ç¨‹æ ‡é¢˜
- `description` - è¯¾ç¨‹æè¿°
- `author` - ä½œè€…åœ°å€
- `price` - è¯¾ç¨‹ä»·æ ¼ï¼ˆweiï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´æˆ³
- `updated_at` - æ›´æ–°æ—¶é—´

### purchases è¡¨

- `id` - è‡ªå¢ä¸»é”®
- `course_id` - è¯¾ç¨‹ID
- `buyer` - è´­ä¹°è€…åœ°å€
- `price` - è´­ä¹°ä»·æ ¼
- `transaction_hash` - äº¤æ˜“å“ˆå¸Œ
- `purchased_at` - è´­ä¹°æ—¶é—´

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨
â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ routes/         # è·¯ç”±é…ç½®
â”œâ”€â”€ database/       # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ connection.ts  # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ migrate.ts     # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ seed.ts        # æµ‹è¯•æ•°æ®
â”œâ”€â”€ contracts/      # æ™ºèƒ½åˆçº¦äº¤äº’
â”œâ”€â”€ types/          # TypeScript ç±»å‹å®šä¹‰
â””â”€â”€ index.ts        # åº”ç”¨å…¥å£
```

### è„šæœ¬å‘½ä»¤

- `npm run dev` - å¼€å‘æ¨¡å¼è¿è¡Œ
- `npm run build` - æ„å»ºé¡¹ç›®
- `npm start` - ç”Ÿäº§æ¨¡å¼è¿è¡Œ
- `npm run migrate` - æ•°æ®åº“è¿ç§»
- `npm run seed` - æ’å…¥æµ‹è¯•æ•°æ®
- `npm run setup` - å®Œæ•´åˆå§‹åŒ–ï¼ˆè¿ç§»+ç§å­æ•°æ®ï¼‰

## éƒ¨ç½²æŒ‡å—

### Docker éƒ¨ç½²

```dockerfile
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3001
CMD ["npm", "start"]
```

### ç¯å¢ƒå˜é‡

ç¡®ä¿ç”Ÿäº§ç¯å¢ƒé…ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼š

- `PORT` - æœåŠ¡ç«¯å£
- `DB_HOST` - æ•°æ®åº“ä¸»æœº
- `DB_USER` - æ•°æ®åº“ç”¨æˆ·
- `DB_PASSWORD` - æ•°æ®åº“å¯†ç 
- `DB_NAME` - æ•°æ®åº“åç§°
- `CONTRACT_ADDRESS` - æ™ºèƒ½åˆçº¦åœ°å€
- `RPC_URL` - åŒºå—é“¾RPCåœ°å€

## æ¶æ„ç‰¹ç‚¹

### æ™ºèƒ½æ•…éšœè½¬ç§»

ç³»ç»Ÿè®¾è®¡äº†æ™ºèƒ½çš„æ•…éšœè½¬ç§»æœºåˆ¶ï¼š

1. **ä¼˜å…ˆä½¿ç”¨æ™ºèƒ½åˆçº¦**ï¼šæ‰€æœ‰æ•°æ®æŸ¥è¯¢é¦–å…ˆå°è¯•ä»æ™ºèƒ½åˆçº¦è·å–
2. **è‡ªåŠ¨æ•°æ®åº“åå¤‡**ï¼šå½“åˆçº¦ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æ•°æ®åº“æŸ¥è¯¢
3. **æ•°æ®åŒæ­¥**ï¼šåˆçº¦å¯ç”¨æ—¶è‡ªåŠ¨åŒæ­¥æ•°æ®åˆ°æ•°æ®åº“
4. **æ— ç¼åˆ‡æ¢**ï¼šå‰ç«¯æ— éœ€æ„ŸçŸ¥æ•°æ®æºå˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

- æ•°æ®åº“è¿æ¥æ± 
- åˆçº¦è°ƒç”¨ç¼“å­˜
- é”™è¯¯é‡è¯•æœºåˆ¶
- è¿æ¥çŠ¶æ€ç›‘æ§

## å®‰å…¨å»ºè®®

- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- å¯ç”¨ HTTPS
- å®æ–½APIé€Ÿç‡é™åˆ¶
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License"